var K=Object.defineProperty,Y=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var J=(e,l,r)=>l in e?K(e,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[l]=r,I=(e,l)=>{for(var r in l||(l={}))ee.call(l,r)&&J(e,r,l[r]);if(W)for(var r of W(l))te.call(l,r)&&J(e,r,l[r]);return e},L=(e,l)=>Y(e,Z(l));import{ad as M,l as S,G as k,v as R,o as g,y as ne,ah as E,ac as B,n as le,ao as re,a0 as se}from"./vendor.9c15ff54.js";function Ee(e){return e}function xe(e){return e}function $e(e){return e}function Fe(e){return e}function Oe(e){return e}function Te(e){return e}function Re(e){return e}const $=M.extend({type:"string",base:M.string(),messages:{"string.contains":"{{#label}} must contain [{{#substring}}]","string.ncontains":"{{#label}} can't contain [{{#substring}}]"},rules:{contains:{args:[{name:"substring",ref:!0,assert:e=>typeof e=="string",message:"must be a string"}],method(e){return this.$_addRule({name:"contains",args:{substring:e}})},validate(e,l,{substring:r}){return e.includes(r)===!1?l.error("string.contains",{substring:r}):e}},ncontains:{args:[{name:"substring",ref:!0,assert:e=>typeof e=="string",message:"must be a string"}],method(e){return this.$_addRule({name:"ncontains",args:{substring:e}})},validate(e,l,{substring:r}){return e.includes(r)===!0?l.error("string.ncontains",{substring:r}):e}}}}),ae={requireAll:!1};function ie(e,l){var r,u;e=e||{},l=S.exports.merge({},ae,l);const t={},n=Object.keys(e)[0];if(!n)throw new Error(`[generateJoi] Filter doesn't contain field key. Passed filter: ${JSON.stringify(e)}`);const o=Object.values(e)[0];if(!o)throw new Error(`[generateJoi] Filter doesn't contain filter rule. Passed filter: ${JSON.stringify(e)}`);if(((r=Object.keys(o)[0])===null||r===void 0?void 0:r.startsWith("_"))===!1)t[n]=$.object({[n]:ie(o,l)});else{const i=Object.keys(o)[0],a=Object.values(o)[0],p=()=>{var s;return(s=t[n])!==null&&s!==void 0?s:$.any()},d=()=>{var s;return(s=t[n])!==null&&s!==void 0?s:$.string()},b=()=>{var s;return(s=t[n])!==null&&s!==void 0?s:$.number()},v=()=>{var s;return(s=t[n])!==null&&s!==void 0?s:$.date()};if(i==="_eq"&&(t[n]=p().equal(a)),i==="_neq"&&(t[n]=p().not(a)),i==="_contains"&&(t[n]=d().contains(a)),i==="_ncontains"&&(t[n]=d().ncontains(a)),i==="_starts_with"&&(t[n]=d().pattern(new RegExp(`^${S.exports.escapeRegExp(a)}.*`),{name:"starts_with"})),i==="_nstarts_with"&&(t[n]=d().pattern(new RegExp(`^${S.exports.escapeRegExp(a)}.*`),{name:"starts_with",invert:!0})),i==="_ends_with"&&(t[n]=d().pattern(new RegExp(`.*${S.exports.escapeRegExp(a)}$`),{name:"ends_with"})),i==="_nends_with"&&(t[n]=d().pattern(new RegExp(`.*${S.exports.escapeRegExp(a)}$`),{name:"ends_with",invert:!0})),i==="_in"&&(t[n]=p().equal(...a)),i==="_nin"&&(t[n]=p().not(...a)),i==="_gt"&&(t[n]=Number.isSafeInteger(a)?b().greater(a):v().greater(a)),i==="_gte"&&(t[n]=Number.isSafeInteger(a)?b().min(a):v().min(a)),i==="_lt"&&(t[n]=Number.isSafeInteger(a)?b().less(a):v().less(a)),i==="_lte"&&(t[n]=Number.isSafeInteger(a)?b().max(a):v().max(a)),i==="_null"&&(t[n]=p().valid(null)),i==="_nnull"&&(t[n]=p().invalid(null)),i==="_empty"&&(t[n]=p().valid("")),i==="_nempty"&&(t[n]=p().invalid("")),i==="_between")if(a.every(s=>Number.isSafeInteger(s))){const s=a;t[n]=b().greater(s[0]).less(s[1])}else{const s=a;t[n]=v().greater(s[0]).less(s[1])}if(i==="_nbetween")if(a.every(s=>Number.isSafeInteger(s))){const s=a;t[n]=b().less(s[0]).greater(s[1])}else{const s=a;t[n]=v().less(s[0]).greater(s[1])}if(i==="_submitted"&&(t[n]=p().required()),i==="_regex"){const s=a.startsWith("/")&&a.endsWith("/");t[n]=d().regex(new RegExp(s?a.slice(1,-1):a))}}return t[n]=(u=t[n])!==null&&u!==void 0?u:$.any(),l.requireAll&&(t[n]=t[n].required()),$.object(t).unknown()}function je(e){if(e===null)return[];const l=/{{(.*?)}}/g;let r=e.match(l);return Array.isArray(r)?(r=r.map(u=>u.replace(/{{/g,"").replace(/}}/g,"").trim()),r):[]}function Ie(e){var l,r,u;const{relation:t,collection:n,field:o}=e;return t?t.collection===n&&t.field===o&&((l=t.meta)===null||l===void 0?void 0:l.one_collection_field)&&((r=t.meta)===null||r===void 0?void 0:r.one_allowed_collections)?"m2a":t.collection===n&&t.field===o?"m2o":t.related_collection===n&&((u=t.meta)===null||u===void 0?void 0:u.one_field)===o?"o2m":null:null}const ue="stores",oe="api",ce="extensions";function fe(e,l,r){const u=e[l],t=e.length,n=l-r;if(u===void 0)return e;if(n>0)return[...e.slice(0,r),u,...e.slice(r,l),...e.slice(l+1,t)];if(n<0){const o=r+1;return[...e.slice(0,l),...e.slice(l+1,o),u,...e.slice(o,t)]}return e}function de(){const e=k(ue);if(!e)throw new Error("[useStores]: The stores could not be found.");return e}function ve(){const e=k(oe);if(!e)throw new Error("[useApi]: The api could not be found.");return e}function pe(){const e=k(ce);if(!e)throw new Error("[useExtensions]: The extensions could not be found.");return e}function me(e){const{useCollectionsStore:l,useFieldsStore:r}=de(),u=l(),t=r(),n=typeof e=="string"?R(e):e,o=g(()=>u.collections.find(({collection:c})=>c===n.value)||null),i=g(()=>n.value?t.getFieldsForCollection(n.value):[]),a=g(()=>{var c;if(!i.value)return{};const f={};for(const w of i.value)((c=w.schema)===null||c===void 0?void 0:c.default_value)&&(f[w.field]=w.schema.default_value);return f}),p=g(()=>i.value.find(c=>{var f;return c.collection===n.value&&((f=c.schema)===null||f===void 0?void 0:f.is_primary_key)===!0})||null),d=g(()=>{var c;return((c=i.value)===null||c===void 0?void 0:c.find(f=>{var w;return(((w=f.meta)===null||w===void 0?void 0:w.special)||[]).includes("user_created")}))||null}),b=g(()=>{var c,f;return((f=(c=o.value)===null||c===void 0?void 0:c.meta)===null||f===void 0?void 0:f.sort_field)||null}),v=g(()=>{var c,f;return((f=(c=o.value)===null||c===void 0?void 0:c.meta)===null||f===void 0?void 0:f.singleton)===!0}),s=g(()=>!o.value||!o.value.meta?null:o.value.meta.accountability);return{info:o,fields:i,defaults:a,primaryKeyField:p,userCreatedField:d,sortField:b,isSingleton:v,accountabilityScope:s}}function Ne(e,l,r=!0){const u=ve(),{primaryKeyField:t}=me(e),{fields:n,limit:o,sort:i,search:a,filter:p,page:d}=l,b=g(()=>e.value?e.value.startsWith("directus_")?`/${e.value.substring(9)}`:`/items/${e.value}`:null),v=R([]),s=R(!1),c=R(null),f=R(null),w=R(null),D=g(()=>{var _,y;return f.value===null||f.value<((_=E(o))!==null&&_!==void 0?_:100)?1:Math.ceil(f.value/((y=E(o))!==null&&y!==void 0?y:100))});let F=null,O=null;const A=S.exports.throttle(q,500);return r&&A(),ne([e,o,i,a,p,n,d],async(_,y)=>{if(S.exports.isEqual(_,y))return;const[h,m,x,T,N,j,ye]=_,[P,G,H,V,z,he,be]=y;!h||!l||((!S.exports.isEqual(N,z)||!S.exports.isEqual(x,H)||m!==G||T!==V)&&P&&(d.value=1),h!==P&&Q(),A())},{deep:!0,immediate:!0}),{itemCount:f,totalCount:w,items:v,totalPages:D,loading:s,error:c,changeManualSort:X,getItems:q};async function q(){var _,y;if(!b.value)return;F==null||F.cancel(),F=null,c.value=null,O&&clearTimeout(O),O=setTimeout(()=>{s.value=!0},150);let h=[...(_=E(n))!==null&&_!==void 0?_:[]];!((y=E(n))===null||y===void 0?void 0:y.includes("*"))&&t.value&&h.includes(t.value.field)===!1&&h.push(t.value.field),h=h.filter(m=>m.startsWith("$")===!1);try{F=B.CancelToken.source();const m=await u.get(b.value,{params:{limit:E(o),fields:h,sort:E(i),page:E(d),search:E(a),filter:E(p),meta:["filter_count","total_count"]},cancelToken:F.token});let x=m.data.data;e.value==="directus_files"&&(x=x.map(T=>L(I({},T),{$thumbnail:T}))),v.value=x,w.value=m.data.meta.total_count,f.value=m.data.meta.filter_count,d&&x.length===0&&(d==null?void 0:d.value)!==1&&(d.value=1)}catch(m){B.isCancel(m)||(c.value=m)}finally{O&&(clearTimeout(O),O=null),s.value=!1}}function Q(){v.value=[],w.value=null,f.value=null}async function X({item:_,to:y}){var h;const m=(h=t.value)===null||h===void 0?void 0:h.field;if(!m)return;const x=v.value.findIndex(j=>j[m]===_),T=v.value.findIndex(j=>j[m]===y);v.value=fe(v.value,x,T);const N=g(()=>`/utils/sort/${e.value}`);await u.post(N.value,{item:_,to:y})}}const C="wrapper",U=["selection","layoutOptions","layoutQuery"];function ge(e){return U.includes(e)}function _e(e){return le({name:`${e.id}-${C}`,props:{collection:{type:String,required:!0},selection:{type:Array,default:()=>[]},layoutOptions:{type:Object,default:()=>({})},layoutQuery:{type:Object,default:()=>({})},filter:{type:Object,default:null},filterUser:{type:Object,default:null},filterSystem:{type:Object,default:null},search:{type:String,default:null},showSelect:{type:String,default:"multiple"},selectMode:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},resetPreset:{type:Function,default:null},clearFilters:{type:Function,default:null}},emits:U.map(l=>`update:${l}`),setup(l,{emit:r}){const u=re(I(I({},e.setup(l,{emit:r})),se(l)));for(const t in u)u[`onUpdate:${t}`]=n=>{ge(t)?r(`update:${t}`,n):Object.keys(l).includes(t)||(u[t]=n)};return{state:u}},render(l){return l.$slots.default!==void 0?l.$slots.default({layoutState:l.state}):null}})}function ke(e){const{layouts:l}=pe(),r=g(()=>l.value.map(t=>_e(t)));return{layoutWrapper:g(()=>{const t=r.value.find(n=>n.name===`${e.value}-${C}`);return t===void 0?r.value.find(n=>n.name===`tabular-${C}`):t})}}function Ce(e,l,r){return g({get(){return e[l]},set(u){r(`update:${l}`,u)}})}export{oe as A,ce as E,ue as S,ke as a,me as b,je as c,Fe as d,Ie as e,Re as f,ie as g,xe as h,Ee as i,$e as j,Ne as k,Oe as l,Te as m,de as n,ve as o,pe as p,Ce as u};
